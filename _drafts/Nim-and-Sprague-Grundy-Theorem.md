---
title: Nim and Sprague-Grundy Theorem [wip]
tags: 
- Combinatorial-Game-Theory
- Problem-Solving
mathjax: true
date: 2021-04-27 00:00:00
---

# 들어가며

세상에는 아주 많은 게임이 있는데, 사람들과 게임을 하다 보면 게임의 필승 전략이 궁금해진다. 두 경기자 중 하나의 필승 전략이 존재한다는 사실은 쉽게 알 수 있다.   

>   결과가 선수의 승 또는 후수의 승으로 정해지는 임의의 유한 완전정보 2인 게임을 수행하는 두 경기자에 대해, 선수의 필승 전략 또는 후수의 필승 전략 중 정확히 하나가 존재한다.

당연히 둘이 동시에 존재할 수는 없고, 선수의 필승 전략이 없는 것은 후수가 수를 잘 선택하여 선수가 승리하지 못하게 만들 수 있음을 의미하므로 이때 후수는 필승 전략을 갖는다. 그러나 이 사실은 그러한 필승 전략이 어떠한 형태로 구성되어야 하는지는 말해주지 않는다.

Nim은 간단한 유한 완전정보 대칭 2인 게임이다. 게임의 상태는 몇 개의 돌 무더기로 표현되고, 각 수는 한 무더기를 선택하여 그에서 돌을 임의로 제거한다. Nim과 그 변형은 대부분 경기자가 수를 진행할 수 없을 때 게임이 끝나고 그 경기자는 게임에서 지게 된다. 

다음 절부터 [1]을 따라 Nim과 잘 알려진 Nim의 변형인 Misère Nim의 필승 전략, 그리고 임의의 비대칭 완전정보 유한 게임의 상태를 Nim으로 번역할 수 있음을 말하는 스프라그-그런디 정리와, 게임의 상태를 Nim의 상태와 대응시키는 그런디 평가--게임의 상태에 그런디 값을 부여하는 방법--에 대해 기술한다.

이 포스트에서 사용되는 용어는 일반적으로 사용되는 용어와 비슷한 의미를 갖도록 사용하였지만, 구체적인 부분에서는 여러 규모로 다를 수 있음에 주의하여야 한다. 또한 되는 대로 한국어를 사용하였기 때문에 용어에 대한 부적절한 번역이 다수 존재할 수 있다. Problem-Solver들을 위한 글을 작성하려고 계획하였는데 목적에 잘 맞는 글이 완성되었으면 한다.

2021년 5월 2일의 감상: 쓰다 보니 너무 길어서 현대인을 배려하는 글 같지는 않다. 퇴고할 때 양을 줄이는 편이 좋다.

# 게임에 관한 정의와 게임 모형

**주의! 이 절이 설명하는 내용은 단지 필요할지도 모른다는 욕심과 cwlo2F의 자기 만족을 위해 쓰여졌다. 어떻게 보면 퇴고하지 않은 원고를 블로그 포스트로 발행한 것이므로 이후 포스트 발행에서 필요 없다고 생각되면 삭제할 수도 있다.**

## 개요

이 글에서 다루는 게임은 체스나 바둑 따위의 (이산적인) 추상전략게임과 같다. 게임은 크게 **상태**<sup>**state**</sup>, **수**<sup>**move**</sup>, 그리고 **경기자**<sup>**player**</sup>로 구성된다. 게임은 어떤 상태에서 시작하고, 경기자들이 각자의 차례를 따라 수를 두어 상태를 바꾼다. 몇몇 상태는 **결과 상태**<sup>**terminal state**</sup>인데, 수들을 적용하여 이 상태에 이르면 게임을 종료하고, 게임의 규칙에 의해 그 결과 상태에 매겨진 값을 게임의 결과로 한다. 한편, **결과가 아닌 상태**<sup>**non-terminal state**</sup>, 즉 결과 상태가 아닌 상태에서는 게임이 종료되지 않고, 어떤 경기자가 어떤 수를 두어 게임의 상태를 바꿔야 한다.
한편, 임의의 게임의 각 결과 상태에서 수 집합을 공집합으로 바꾸어 줌으로써 새로운 게임을 얻을 수 있다. 이때 가능한 수의 집합이 공집합임은 상태가 결과 상태임과 동치이다. 이 새로운 게임은 기존 게임과 똑같이 움직이므로, 임의의 게임에 대해 결과 상태에서는 가능한 수가 존재하지 않는다고 가정하여도 무방하다. 

게임에 대한 좀 더 좋은 설명 혹은 정의가 있지만, 아직 게임을 수학 언어로 본을 뜨지 않았고, 결국 그것을 한 뒤에 여러 결과를 얻을 것이므로 지금 무언가 더 말하려는 것은 낭비일 수 있다. 정의를 대충 알고 있다면 이 절의 나머지는 말장난처럼 느껴질 수 있으니 다음 절으로 넘어가도 무방하다. 한편, [3]에서 집합론의 언어를 좀 더 적극적으로 사용하여 게임을 정의한다.

* 게임이 **완전정보**<sup>**perfect information**</sup> 게임이라는 것은, 그것이 상태, 수에 관한 모든 정보를 경기자에게 제공하는 게임이라는 것이다. 예를 들어, 서로 손패를 보여주지 않는 여러 게임은 완전정보 게임이 아니다.

* 게임이 **유한**<sup>**finite**</sup>하다는 것은, 어떤 자연수 $M$이 존재하여 그 결과가 항상 $M$번 이하의 수가 두어졌을 때 결정되는 게임이라는 것이다. 유한하지 않은 게임의 예시로는 무승부에 관한 규칙을 뺀, 서로 킹만 남은 상황의 체스가 있다.

* 게임이 **정규**<sup>**normal**</sup> 게임이라는 것은, 자신의 차례에 게임의 상태가 결과 상태인 경기자가 패배하는 게임이다. 즉, 자신의 차례에 둘 수 있는 수가 없으면 패배한다.

* **2인 게임**<sup>**two-player game**</sup>은 경기자가 둘 있는 게임이다. 편의를 위해 각 경기자가 자신의 차례에 수를 정확하게 한 번 두고 나서 다른 경기자에게 차례가 넘어간다고 가정할 수 있다. 만약 어떤 경기자가 한 차례에 수를 두 번 이상 둘 수 있다면, 그 수들을 하나의 수로 축약하여 새로운 게임을 만들 수 있다. 만약 어떤 경기자가 자신의 차례를 쉴 수 있다면, 쉬어가는 수를 하나의 수로 추가하여 새로운 게임을 만들 수 있다. 이렇게 새로 만들어진 게임은 기존 게임과 똑같이 움직인다. 

* 2인 게임이 **대칭**<sup>**impartial**</sup>이라는 것은, 그것이 두 경기자 사이에 오직 선/후수의 차이만이 존재하는 게임이라는 것이다. 즉, 대칭 2인 게임은 각 상태에서 수행 가능한 수는 경기자에 의존하지 않는 게임이다. 체스 또는 바둑은 선수와 후수가 각각 백 또는 흑이 되고 각 경기자의 색에 해당하는 수만을 둘 수 있다. 예컨대 체스의 후수가 백의 룩을 움직이는 수를 결코 둘 수 없지만, 선수는 규칙에 맞게 얼마든지 백의 룩을 움직이는 수를 둘 수 있다. 이러한 게임들은 대칭이 아니라고 할 것이다. 한편, 일본어 위키백과에서는 impartial game을 不偏ゲーム으로 번역한다. 한국어로 한자를 읽어 *불편 게임*으로 읽을 수도 있겠지만, 왠지 불편하므로 대칭 게임이라는 용어를 사용하기로 하였다.

## 게임 본뜨기

앞으로 서술할 게임은, 유한하고, 완전정보 게임이고, 대칭인 2인 정규 게임이다. 저 용어들이 다 들어가 있다는 것만 기억하면 순서는 사용하는 사람이 가장 자연스럽다고 생각하는대로 섞어도 무방할 듯 하다.

**주의! 이 절의 나머지는 집합론적이면서도 나사가 몇 개 빠진 내용을 다룬다. 집합론 또는 못 쓴 글이 싫다면 이 절의 나머지는 건너 뛰는 편이 좋다. 건너 뛰지 않기를 결정했다면 자세히 읽지 않는 편이 좋다.**

게임 하나를 고정하자. 유한, 완전정보, 대칭, 정규성의 특징들을 모두 갖는, 아주 특별한 종류의 게임의 수학적 모형을 본뜰 것이다. 우선, 게임의 상태는 항상 집합이다. 어떤 집합이냐면, 그 게임의 상태에서 수를 두어 바꾸어질 수 있는 모든 가능한 상태들의 집합이다. 즉, 수의 집합과 상태는 동형이다. 서로 다른 상태가 같은 수 집합을 가질 수 있다. 예를 들어, 틱택토의 경우 결과 상태는 공집합 $\emptyset$으로 표현되어야 할 것인데, 서로 다른 결과 상태들이 있다. 집합으로써 완전히 같은 모양이더라도 다른 상태에서 온 집합을 구별할 수 있도록, 이 집합이 어떤 게임의 상태로부터 왔다는 사실을 잊지 않도록 하여 수의 (다중)집합을 구성하자. 

$G$를 게임의 모든 상태들의 집합이라고 하자. 경기자는 현재 상태를 확인하고, 수를 두어 게임을 다음 상태로 만든다. 다음 상태로 만든다는 성질을 이용하여 경기자를 함수 $f: G \to G \cup \{end\}$으로 본뜰 수 있다. 경기자는 현재 상태에서 가능한 수를 두기 때문에, 상태 $x \in G$에 대해, $x = \emptyset$가 공집합이라면 $f(\emptyset) = end$, $x$가 공집합이 아니라면 $f(x) \in x$이어야 한다. 게임이 정규 게임이므로, 경기자는 자신의 수에 의해 $end$를 얻으면 게임에서 지게 된다. 따라서 게임의 필승 전략은 $end$를 가능한 한 잘 피할 수 있는 경기자 함수와 같다.

이와 같은 구성은 게임의 유한성을 이용하여 계산할 수 있다. 유한성에 의해, 처음 상태에서, 또한 모든 결과가 아닌 상태에서 유한 번의 경기자 함수 적용을 통해 결과 상태에 도달할 수 있다. 모든 결과 상태는 공집합이고, 유한번의 되돌아가기를 통해 처음 상태로 도달할 수 있다. 이를 통해 모든 상태에 대해 바텀-업 방식으로 그 상태에 대응되는 수 집합을 구성할 수 있다. 이렇게 구성된 집합의 계층의 깊이는 항상 유한하므로 이상한 일은 발생하지 않을 것이다.

게임의 대칭성을 사용하면 선수와 후수는 같은 승리 전략 경기자 함수를 가지고 게임을 할 수 있을 것이다. 선수 또는 후수에게 필승 전략이 존재할 때 필승 전략이 없는 경기자의 경기자 함수는 사실 아무 함수나 들고 와도 되기 때문이다. 이러한 사실은 게임 대신 게임 규칙이 주어졌을 때 좀 더 유용할 것으로 생각된다.

이렇게 게임의 상태를 집합, 경기자를 $상태 \to 상태$ 형태의 함수로 본뜰 수 있는 것은 게임의 대칭성에서 기인한다. 대칭이 아닌 게임의 경우, 상태는 각 경기자에게 가능한 수 집합의 순서쌍 정도로 주어질 수 있겠지만, 적어도 그냥 수 집합보다는 복잡할 것이다. 

## 집합론 멈춰!

집합론의 언어를 열심히 사용하여 상태를 본떠 보았는데, 집합이라는 구조 대신 [1]에서와 같이 단순히 그래프를 통해 본뜰 수도 있다. 이때 상태는 정점이고 수는 방향 있는 간선이다. 경기자는 각 정점에서 방향 있는 간선을 따라 새로운 정점으로 게임을 이동시킨다. 게임의 유한성에 주목한다면, 이러한 그래프 구조에 순환이 생기지 않아야 한다는 것을 알 수 있고, 따라서 이 그래프 모형은 유향 순환 없는 그래프<sup>directed acyclic graph</sup>의 구조를 갖는다. 경기자는 각 정점에서 방향 간선으로 연결된 정점을 선택하는 함수로 표현할 수 있다. 게임의 대칭성에 의해 이러한 게임 그래프와 경기자 함수는 적절하다. 대칭적이지 않다면 게임의 그래프를 좀 더 복잡한 것으로 바꾸어서 비슷한 방법으로 정의할 수 있을 것이다.

정의가 본질적으로 다르지 않고, 집합보다는 그래프가 상상하기 편하기 때문에 이 정의를 사용하여도 무방하다.

## 변명

게임의 성질을 이용하여 집합 모형과 유향 순환 없는 그래프 모형을 구상하였다. 보통은 이런 모형을 먼저 만든 다음에, 이 모형을 게임이라고 이름 붙이고, 유한성 또는 대칭성 등을 증명하여야 할 것이다. 유한이니 대칭이니 하는 것을 애초에 *잘 정의하지 않았기* 때문에 위화감이 느껴지는 것으로 믿는다. 그러나 이런 방식으로 무언가를 하는 것을 재미있어 하는 사람이 없을 것 같고, 시간을 써서 완성하더라도 다른 참고 문헌에 등장하는 작업보다 못한 것을 되풀이하는 것이 될 것 같으므로 이는 생략하도록 한다.

# Nim

## Nim 게임

유한 개의 돌이 있는 돌 무더기가 유한 개 있다. 갑과 을이 이 돌 무더기들에 대해 게임을 하는데, 갑의 차례에서 시작하여 경기자는 비어있지 않은 돌 무더기를 임의로 고르고, 고른 돌 무더기에서 돌을 한 개 이상 임의로 제거한다. 어떤 경기자가 마지막 돌을 제거하였다면, 그 다음 경기자는 선택 가능한 수가 없으므로 패배한다. 이러한 게임을 Nim이라고 한다. 규칙은 고정되어 있지만, 처음에 주어진 돌 무더기에 따라 게임이 달라짐에 주의하여야 한다. 즉, Nim은 처음 상태와 규칙으로 구성된다고 할 수 있다. Nim은 어떤 특정한 게임보다는 게임의 틀과 비슷하다고 할 수 있다.

Nim 게임의 상태는 양의 정수의 유한 중복집합<sup>multiset</sup>으로 표현된다. 편의를 위해 몇 가지 표기를 도입하자. 유한한 중복집합 $S$과 대상 $x$에 대해, $m(x; S) \in \mathbb{N}$는 $x$가 $S$에서 나타나는 빈도이다. 유한한 중복집합 $S, T$에 대해 $S + T$는 모든 대상 $x$에 대해 
$$m(x; S + T) = m(x; S) + m(x; T)$$
를 만족하는 유일한 유한 중복집합이다. $S - T$는 모든 대상 $x$에 대해
$$m(x; S - T) = \max\\{m(x; S) - m(x; T), 0\\}$$
을 만족하는 유일한 유한 중복집합이다. 각 정수는 돌 무더기를 의미하고, 각 정수의 값은 돌 무더기에 있는 돌의 양을 의미한다. Nim 게임의 수는 다음 중 하나이다.

* 상태 $S$와 $x \in S$에 대해, 상태를 $S - \\{x\\}$로 바꾼다. 돌 무더기를 선택하여 모든 돌을 제거하는 경우이다.
* 상태 $S$와 $x \in S$, $0 < y < x$에 대해, 상태를 $S - \\{x\\} + \\{y\\}$로 바꾼다. 돌 무더기를 선택하여 모든 돌을 제거하지 않는 경우이다.

결과 상태는 공집합이고, 돌이 남아있지 않은 상태와 같다.

*편의를 위해*, 상태를 음이 아닌 정수의 유한 중복집합으로 표현할 수도 있을 것이다. 잘 살펴보면 0이 있든 없든 수 집합의 모양은 변하지 않고, 나아가 게임의 모양도 변하지 않는다. 따라서 원하는 만큼 0을 넣어 비지 않은 무더기가 적더라도 더 많은 무더기를 사용하는 게임의 상태로써 생각할 수 있을 것이다.

마완성; 작업중입니다.

## Nim: 전략

간단한 Nim에는 간단한 승리 전략이 있다. $\oplus$를 비트 xor 연산이라고 하자. 음이 아닌 정수들을 원소로 갖는 유한 중복집합 $S$에 대해, $\bigoplus S = \displaystyle\bigoplus_{x \in S} x$는 $S$의 모든 원소의 xor 합이다. 이를 $S$의 xor 합이라고 하자. 중복집합의 xor 합은 원소의 중복을 생각하여 계산하여야 한다.

Nim의 승리 전략은 각 상태에서 둘 수 있는 수가 xor 합을 어떻게 변화시키는지 관찰함으로써 얻을 수 있다. 다음 두 보조정리를 살펴보자.

**보조정리 1.** 현재 상태의 xor 합이 0이라면, 수를 두었을 때 다음 상태의 xor 합은 항상 0이 아니다.

**보조정리 2.** 현재 상태의 xor 합이 0이 아니라면, 다음 상태의 xor 합이 0이 되도록 하는 수가 존재한다.

한편, 게임이 끝날 때는 항상 xor 합이 0이다. Nim 게임의 승리 전략은 위 보조정리를 사용해서 상대 경기자에게 xor 합이 0인 상태만을 넘겨주고, 게임이 끝나지 않았다면 xor 합이 0이 아닌 상태를 받는 것이다. 이는 처음 상태에 따라, 그리고 상대의 수에 따라 가능할 수도 있고 불가능할 수도 있다. 


## Misère Nim

## Misère Nim: 전략

# 스프라그-그런디 정리

## 개요

스프라그-그런디 정리는, 임의의 게임은 증가-Nim으로 잘 바꾸어 쓸 수 있다는 것을 말하는 정리이다. 

[1]을 따라서 스프라그-그런디 정리를 증명하여 볼 것이다.

## 증가-Nim

증가-Nim은 Nim의 규칙에서 돌을 새로 넣는 수를 추가한 심심한 변형이다. 증가-Nim에서는 Nim의 규칙에서 허용되는 수에 더해, 돌 무더기를 하나 선택하여 돌을 새로 넣는 수가 허용된다. 물론, 게임의 길이가 무한히 길어지지 않도록, 돌을 새로 넣는 수는 제한적으로 사용된다. 

증가-Nim의 승리 전략은 정확하게 Nim의 승리 전략만큼만 어렵다. 한 경기자에게 xor합이 0이 아닌 상태가 주어졌다고 하자. 그는 상대가 Nim 규칙의 수를 두면 Nim 처럼 게임을 할 것이다. 상대가 돌을 증가시키는 수를 두면, 상대가 증가시킨 돌을 제거할 것이다. 게임이 유한하다는 가정에 의해. 결과가 나올 때까지 이를 반복하면 이기게 된다.

증가-Nim은 껄끄럽다. 그냥 증가하는 수를 없애더라도 게임의 전략에 영향을 주지 않는다. 

## 증명: 그런디 평가


아주 천천히 작업 중; 거의 진행되지 않음. 마지막 업데이트 2021-06-28.

# 참고 문헌

[1] CP-Algorithms. [*Sprague-Grundy theorem. Nim.*](https://cp-algorithms.com/game_theory/sprague-grundy-nim.html)
[2] Wikipedia. [*Sprague-Grundy theorem.*](https://en.wikipedia.org/wiki/Sprague%E2%80%93Grundy_theorem)
[3] Schleicher, Dierk; Stoll, Michael (2006). *An Introduction to Conway's Games and Numbers.* [arXiv:math.CO/0410026](https://arxiv.org/abs/math/0410026).